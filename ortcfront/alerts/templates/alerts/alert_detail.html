{% extends "base.html" %}{% load leaflet_tags %}{% load geojson_tags %}
{% load i18n %}{% load compress %}{% load crispy_forms_tags %}
{% block title %} : {{object.name}}{% endblock %}
{% block content %}
<div class="row">
  <div class="col-md-10">

    <div class="row">
      <div class="col-md-6">

	<h3>{% trans "Alert" %} : {{object.name}}</h3>
	<hr/>
	<div>
	  <ul>
	    <li>
	      {% trans "Domain" %} : <a href="{{object.domain.get_absolute_url}}">{{object.domain}}</a>
	    </li>
	    <li>
	      {% trans "Created by" %} {{object.create_by.username}}
	    </li>
	    <li>
	      {% trans "Created on" %} {{object.create_on}}
	    </li>
	    <li>Subscribers : <span class="badge">{{object.nb_subscribers}}</span></li>
	    <li>Notifications : {{object.nb_notifications}}</li>
	  </ul>
	</div>

	<table class="table table-striped">
	  <thead>
	    <tr>
	      <th>{% trans "Rules" %}</th>
	    </tr>
	  </thead>
	  <tbody>
	    {% for rule in object.get_rules %}
	    <tr>
	      <td><a href="{{rule.get_absolute_url }}">{{rule.name}}</a></td>
	      <td>{{rule.tag_regex}}</td>
	    </tr>
	    {% endfor %}
	  </tbody>
	</table>
      </div>
      <div class="col-md-6">
	{% leaflet_map "alert_detail" callback="main_map_init" %}
	{% if object.description %}
	<hr/>

	 <div>
	   <div class="alert alert-info">

	     {{object.description}}
	   </div>
	 </div>
	 {% endif %}
       </div>
     </div>
   </div>

  <div class="col-md-2">
      <p>
	<a href="{% url 'alert_subscribe' object.id %}" class="btn btn-primary btn-block">{% trans "Subscribe" %}</a>
      </p>

    <div>
      <ul>

      </ul>
    </div>

    <div>
      {% for subscriber in object.get_subscribers %}
      <tr>
	<td>{{subscriber.user.username}}</a></td>
	<td>{{rule.tag_regex}}</td>
      </tr>
      {% endfor %}
    </div>

  </div>
</div>
<script type="text/javascript">
  function main_map_init (map, options) {

  var layer = L.geoJson();
  map.addLayer(layer);
  $.getJSON("{% url 'geozone_geojson' object.geozone.id %}", function (data) {
    layer.addData(data);
    map.fitBounds(layer.getBounds());
  });
  }
</script>
{% endblock %}
